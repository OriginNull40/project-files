<!DOCTYPE html>
<html>
<head>
    <title>PSX Console</title>
    <style>body{margin:0;background:#000;color:#0f0;font-family:monospace;}</style>
</head>
<body>
    <div id="log">> INITIATING BOOT...</div>
    <canvas id="canvas" style="width:100%;height:100%;position:absolute;"></canvas>

    <script>
        const log = (msg) => { document.getElementById('log').innerHTML += "<br>> " + msg; };
        
        // This handles the communication between the feed and the emulator
        window.EmuConfig = {
            onRuntimeInitialized: () => {
                log("CORE READY. ATTEMPTING MOUNT...");
                const params = new URLSearchParams(window.location.search);
                const feedUrl = params.get('feed');
                log("FETCHING FEED: " + feedUrl);
                
                fetch(feedUrl)
                    .then(r => r.json())
                    .then(data => {
                        log("FEED RECEIVED. LOADING GAME...");
                        // This is where the magic happens
                        Module.loadRom(data.categories[0].items[0].props.rom);
                    })
                    .catch(e => log("FEED_ERROR: " + e.message));
            }
        };
    </script>
    <script src="mednafen_psx_libretro.js"></script>
</body>
</html>
